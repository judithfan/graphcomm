<!doctype html>
<html>
  <head>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>       
    <script src="js/jquery.min.js"></script>
    <script src="js/snap.svg-min.js"></script>
    <script src="js/jspsych.js"></script>
    <script src="js/jspsych-nAFC-circle.js"></script>
    <script src="js/lodash.min.js"></script>
    <script src="js/object_list.js"></script>
    <link rel="stylesheet" href="./jspsych-custom.css"></link>

    <script>
      window.onload = function() { 

        var socket = io.connect();
        socket.on('onconnected', function(d) {
          var meta = d.meta;
          var id = d.id;

          // high level experiment parameter (placeholder)
          var num_trials = meta.length;

          // define trial list
          var trials_tmp = {  
            type: 'nAFC-circle',
            num_trials: num_trials,
            target: _.map(meta, 'target'),
            sketch: _.map(meta, function(x) { return './sketch/' + x.filename }),
            category: _.map(meta, 'category'),
            distractor1: _.map(meta, 'Distractor1'),
            distractor2: _.map(meta, 'Distractor2'),
            distractor3: _.map(meta, 'Distractor3'),
            context: _.map(meta, 'condition'),
            draw_duration: _.map(meta, 'drawDuration'),
            num_strokes: _.map(meta, 'numStrokes'),
            viewer_correct_in_context: _.map(meta, 'outcome'),
            viewer_response_in_context: _.map(meta, 'response'),
            viewer_RT_in_context: _.map(meta, 'viewerRT'),
            original_gameID: _.map(meta,'gameID'),
            sketch_size: [220,220],
            object_size: [80,80],
            circle_diameter: 800,  
            options: object_list,
            set_size: 32
          };

          var trials = new Array(trials_tmp.options.length);

          for (var i = 0; i < trials_tmp.options.length; i++) {
            trials[i] = {type: trials_tmp.type};            
            trials[i].set_size = trials_tmp.set_size || 32;
            trials[i].num_trials = trials_tmp.num_trials || 10;
            trials[i].target = trials_tmp.target[i];
            trials[i].sketch = trials_tmp.sketch[i];
            trials[i].category = trials_tmp.category[i],
            trials[i].distractor1 = trials_tmp.distractor1[i],
            trials[i].distractor2 = trials_tmp.distractor2[i],
            trials[i].distractor3 = trials_tmp.distractor3[i],
            trials[i].context = trials_tmp.context[i],
            trials[i].draw_duration = trials_tmp.draw_duration[i],
            trials[i].num_strokes = trials_tmp.num_strokes[i],
            trials[i].viewer_correct_in_context = trials_tmp.viewer_correct_in_context[i],
            trials[i].viewer_response_in_context = trials_tmp.viewer_response_in_context[i],
            trials[i].viewer_RT_in_context = trials_tmp.viewer_RT_in_context[i],
            trials[i].original_gameID = trials_tmp.original_gameID[i],
            trials[i].object_size = trials_tmp.object_size || [100, 100];
            trials[i].sketch_size = trials_tmp.sketch_size || [16, 16];
            trials[i].circle_diameter = trials_tmp.circle_diameter || 250;
            trials[i].timing_sketch = (typeof trials_tmp.timing_sketch === 'undefined') ? 100 : trials_tmp.timing_sketch;
            trials[i].options = trials_tmp.options || _.times(trials_tmp.set_size,_.constant('./object/dogs_08_pug_0035.png'))
			      }
			      console.log(trials);
	  jsPsych.init({
//            display_element: $('#display-area'),
            timeline: trials
          });          

        })
      }      

    </script>


  </head>
  <body>
    <div id="display-area"></div>
  </body>
</html>
